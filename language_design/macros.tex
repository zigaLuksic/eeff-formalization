% !TeX root = main.tex
% chktex-file 1
% chktex-file 46
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% General
\newcommand{\EEFF}{\textit{\textsf{EEFF}}~}
\newcommand{\todo}[2][]{\textcolor{red}{\textsc{#1} #2}}
% \newcommand{\todo}[2][]{}
\newcommand{\code}[1]{\mathtt{#1}}
\definecolor{superlightgray}{gray}{0.80}
\newcommand{\highlight}[1]{\setlength{\fboxsep}{2pt}\colorbox{superlightgray}{\ensuremath{#1}}}
\newenvironment{ruledfigure}[1][!hbtp]{%
	\begin{figure}[#1]%
		\begin{center}%
		\noindent\rule{\textwidth}{1pt}%
		\small
}{%
	\noindent\rule{\textwidth}{1pt}%
	\end{center}%
	\end{figure}%
}

\newtcbox{\emphbox}{nobeforeafter,colframe=shadecolor,colback=shadecolor,boxrule=0pt,arc=4pt, boxsep=0pt,left=3pt,right=3pt,top=3pt,bottom=3pt,tcbox raise base}
\newtcbox{\emphunderlinebox}{nobeforeafter,colframe=shadecolor,colback=shadecolor,boxrule=0pt,arc=4pt, boxsep=0pt,left=3pt,right=3pt,top=3pt,bottom=1pt,tcbox raise base}

\newcommand{\defeq}{\stackrel{\text{def}}{=}}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Named Typing Relations
\newcommand{\ruleform}[1]{\fbox{$#1$}}

% Meta-variables (Types & Constraints)
\newcommand{\tyA}{\mathit{A}}
\newcommand{\tyB}{\mathit{B}}
\newcommand{\ctyC}{\underline{C}}
\newcommand{\ctyD}{\underline{D}}
\newcommand{\sig}{\Sigma}

% Meta-variables (Templates & Equations)
\newcommand{\tmplT}{\mathit{T}}
\newcommand{\eqE}{\mathcal{E}}

% Meta-variables (Values & Computations)
\newcommand{\hcases}{\mathit{h}}

\newcommand{\logic}{\ensuremath{\mathcal{L}}}
\newcommand{\fulllogic}{\ensuremath{\mathcal{L}_\text{full}}}
\newcommand{\freelogic}{\ensuremath{\mathcal{L}_\text{free}}}
\newcommand{\eqlogic}{\ensuremath{\mathcal{L}_\text{eq}}}
\newcommand{\emptylogic}{\ensuremath{\mathcal{L}_\emptyset}}
\newcommand{\predlogic}{\ensuremath{\mathcal{L}_\text{pred}}}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Values
\newcommand{\unit}{\mathtt{(\,)}}
\newcommand{\pair}[2]{(#1,#2)}
\newcommand{\cons}[2]{<#1, #2>}
\newcommand{\inleft}[1]{\mathtt{Left}~#1}
\newcommand{\inright}[1]{\mathtt{Right}~#1}
\newcommand{\true}{\mathtt{true}}
\newcommand{\false}{\mathtt{false}}

% Keywords
\newcommand{\keylet}{\mathtt{let}}
\newcommand{\keyrec}{\mathtt{rec}}
\newcommand{\keyin}{\mathtt{in}}
\newcommand{\keyreturn}{\mathtt{ret}}
\newcommand{\keydo}{\mathtt{do}}
\newcommand{\keyfun}{\mathtt{fun}}
\newcommand{\keyhandle}{\mathtt{handle}}
\newcommand{\keyhandler}{\mathtt{handler}}
\newcommand{\keymatch}{\mathtt{match}}
\newcommand{\keywith}{\mathtt{with}}
\newcommand{\keyif}{\mathtt{if}}
\newcommand{\keythen}{\mathtt{then}}
\newcommand{\keyelse}{\mathtt{else}}
\newcommand{\keyabsurd}{\mathtt{absurd}}
\newcommand{\op}{\mathit{op}}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Code construction
% Term Abstraction
\newcommand{\fun}[2]{\keyfun~{#1} \mapsto{#2}}
% Application
\newcommand{\apply}[2]{{#1}\;{#2}}
% Let
\newcommand{\letbind}[2]{\keylet~{#1} = {#2}~\keyin~}
\newcommand{\letrec}[3]{\keylet~\keyrec~{#1}~{#2} = {#3}~\keyin~}
% Return
\newcommand{\return}[1]{\keyreturn~{#1}}
% Bind
\newcommand{\dobind}[2]{\keydo~{#1} \leftarrow{#2}~\keyin~}
% Match and if
\newcommand{\match}[1]{\keymatch~{#1}~\keywith~}
\newcommand{\ifclause}[3]{\keyif~{#1}~\keythen~{#2}~\keyelse~{#3}}
% Operation
\newcommand{\operation}[3][\op]{
	\ifthenelse{\equal{#3}{}}
	{\ifthenelse{\equal{#2}{}}
		{#1}
		{#1 (#2)}}
	{#1 (#2;\,#3)}}
% Handle
\newcommand{\withhandle}[2]{\keywith~{#1}~\keyhandle~{#2}}
% Handler
\newcommand{\emptyhcases}{\nil}
\newcommand{\handler}[2][\return x \mapsto c_r]{\keyhandler \;({#1}; {#2})}
% Substitution
\newcommand{\subs}[2]{{#1}[{#2}]}
\newcommand{\subsfor}{/}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Equation and template construction
\newcommand{\rel}{\sim}
\newcommand{\teqjudgement}[2]{{#1}\vdash {#2}}
\newcommand{\tvars}{\mathtt{Z}}
\newcommand{\tenvlong}[2]{{#1};{#2}}
\newcommand{\tenv}{\tenvlong{\ctx}{\tvars}}
\newcommand{\thandle}[3][h]{{#2^#1} [{#3}]}
%\newcommand{\tsemhandle}[2][H]{\llparenthesis #2 \rrparenthesis^{#1}}
%\newcommand{\tjsemhandle}[4][H]{\llparenthesis \wftemplate[#3]{#4}{\sig} \rrparenthesis^{#1}}
\newcommand{\respects}[5][\ctx]{#1 \vdash #2 \oftype #4 \casesto #5 \;\mathsf{respects}\; #3}
% Types
\newcommand{\typevar}{\tau}
\newcommand{\bang}{!}
\newcommand{\witheq}{/}
\newcommand{\ctype}[3]{
	\ifthenelse{\equal{#3}{}}
	{#1\bang#2}
	{#1\bang#2\witheq#3}}
\newcommand{\ctypebasic}{\ctype{\tyA}{\sig}{\eqE}}
\newcommand{\set}[1]{\{{#1}\}}
\newcommand{\booltype}{\mathtt{bool}}
\newcommand{\inttype} {\mathtt{int}}
\newcommand{\floattype} {\mathtt{float}}
\newcommand{\stringtype} {\mathtt{string}}
\newcommand{\unittype}{\mathtt{unit}}
\newcommand{\emptytype}{\mathtt{empty}}
\newcommand{\sumtype}[2]{#1 + #2}
\newcommand{\producttype}[2]{#1 \times #2}
\newcommand{\anytype}{\mathtt{*}}
\makeatletter
\newcommand{\superimpose}[2]{%
	{\ooalign{{\raise.2ex\hbox{$#1\@firstoftwo#2$}}\cr\hfil\raise-.2ex\hbox{$#1\@secondoftwo#2$}\hfil\cr}}}
\makeatother
\newcommand{\casesto}{\mathrel{\mathpalette\superimpose{{\rightharpoonup}{\rightharpoondown}}}}
\newcommand{\hto}{\Rightarrow}

% Type-checking
\newcommand{\wfctx}[1]{\vdash #1 \oftype \mathsf{ctx}}
\newcommand{\wftctx}[1]{\vdash #1 \oftype \mathsf{tctx}}
\newcommand{\wfvtype}[1]{\vdash #1 \oftype \mathsf{vtype}}
\newcommand{\wfctype}[1]{\vdash #1 \oftype \mathsf{ctype}}
\newcommand{\wfsig}[1]{\vdash #1 \oftype \mathsf{sig}}
\newcommand{\wftemplate}[3][\tenv]{#1 \vdash #2 \oftype #3}
\newcommand{\wfequations}[2]{\vdash #1 \oftype #2}
\newcommand{\welltyped}[3][\ctx]{#1 \vdash #2 \oftype #3}
\newcommand{\oftype}{\!:\!}
\newcommand{\judgement}[3]{{#1} \vdash {#2} \oftype {#3}}

% Subtyping
\newcommand{\subtypeof}{\leq}

% Operational semantics
\newcommand{\eval}{\Downarrow}
\newcommand{\nil}{\emptyset}
\newcommand{\smallstep}[2]{{#1} \leadsto {#2}}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Logics
\newcommand{\lequal}{\equiv}
\newcommand{\eqjudg}[4][\ctx]{#1 \vdash #2 \lequal_{#4} #3}
\newcommand{\ljudgement}[3]{
\ifthenelse{\equal{#2}{}}
	{#1 \vdash #3}
	{{#1} \vsep {#2} \vdash {#3}}}
\newcommand{\hypo}{\Psi}
\newcommand{\ltrue}{\top}
\newcommand{\lfalse}{\bot}
\newcommand{\lneg}{\neg}
\renewcommand{\land}{\wedge}
\renewcommand{\lor}{\vee}
\newcommand{\limplies}{\Rightarrow}
\newcommand{\lall}{\fall}
\newcommand{\lexists}{\exs}

\newcommand{\ljsem}[3]{\sem{\ljudgement{#1}{#2}{#3}}}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Denotational Semantics
\newcommand{\lift}[2][]{\mathsf{lift}_{#1} #2}
\newcommand{\interp}[2]{\mathsf{interp}_{#1} (#2)}
\newcommand{\freeInterp}[2]{F_{#1, #2}}
\newcommand{\inval}{\text{in}_{\keyreturn}}
\newcommand{\inop}[1][op]{\text{in}_{\mathit{#1}}}
\newcommand{\semTrue}{\mathrm{t\!t}}
\newcommand{\semFalse}{\mathrm{ff}}
\newcommand{\ctx}{\Gamma}

% Handler special stuff
\newcommand{\semcases}{\tilde{h}}
\newcommand{\ocs}{\mathit{ocs}}

% Semantic brackets
\newcommand{\sem}[1]{\llbracket{#1} \rrbracket}
\newcommand{\jsem}[3]{\llbracket\judgement{#1}{#2}{#3} \rrbracket}
\newcommand{\hsem}[2][H]{\sem{#2}^{#1}}
%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Contextual equivalence
\newcommand{\CEhole}[1]{\langle #1 \rangle}
\newcommand{\CEinstantiate}[2]{#1 \CEhole{#2}}
\newcommand{\CEvar}{\mathbb{C}}
\newcommand{\ctxequiv}[4][\ctx]{
	\judgement{#1}{#2 \cong #3}{#4}
}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
% Misc.
\newcommand{\lambdafun}[3]{\lambda{#1} \in{#2} \,. \,{#3}}
\newcommand{\vsep}{\;|\;}
\newcommand{\union}{\cup}
\newcommand{\projection}{\pi}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\exs}[1]{\exists{#1}.\ }
\newcommand{\fall}[1]{\forall{#1}.\ }

\newcommand{\concat}{\;\hat{}\;}
\newcommand{\tab}{\hspace{3mm}}