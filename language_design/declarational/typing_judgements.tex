% !TeX root = ../main.tex
% chktex-file 1
% chktex-file 46


\begin{mathpar}

	% Term Variable
	\inferrule*[]
	{ (x \oftype \tyA) \in \ctx }
	{ \judgement{x}{\tyA} }

	% Constant
	\inferrule*[]{ }
	{ \judgement{\unit}{\unittype} }

	% Integer
	\inferrule*[]{ }
	{ \judgement{n}{\inttype} }

	% Sums
	\inferrule*[]
	{ \judgement{v}{\tyA} }
	{ \judgement{\inleft{} v}{\sumtype{\tyA}{\tyB}} }

	\inferrule*[]
	{ \judgement{v}{\tyB} }
	{ \judgement{\inright v}{\sumtype{\tyA}{\tyB}} }

	% Pairs
	\inferrule*[]
	{ \judgement{v_1}{\tyA} \\ \judgement{v_2}{\tyB} }
	{ \judgement{\pair{v_1}{v_2}}{\producttype{\tyA}{\tyB}} }

	\inferrule*[]
	{ \judgement{v_1}{\tyA} \\ \judgement{v_2}{\tyB} }
	{ \judgement{\pair{v_1}{v_2}}{\producttype{\tyA}{\tyB}} }

	% Function
	\inferrule*[]
	{ \judgement[\ctx, x \oftype \tyA]{c}{\ctyC} }
	{ \judgement{\fun{x}{c}}{\tyA \to \ctyC} }

	% Handler
	\inferrule*[]
	{	\judgement[\ctx, x \oftype \tyA]{c_r}{\ctyD} \\
		\respects{h}{\eqE}{\sig}{\ctyD} }
	{\judgement
		{\handler{h}}
		{\ctype{\tyA}{\sig}{\eqE} \hto \ctyD}
	}

	% Respects

	\inferrule*[]{ }
	{\judgement{\emptyhcases}{\nil \casesto {\ctyD}} }

	\inferrule*[]
	{\judgement
		{h}
		{\sig \casesto {\ctyD}}\\
		\judgement[\ctx, x \oftype \tyA_{\op}, k \oftype \tyB_{\op} \to \ctyD]
		{c_{\op}}
		{\ctyD}\\
		\op \not \in \sig
	}
	{\judgement
		{h \union \set{\operation{x}{k} \mapsto c_{\op}}}
		{(\sig \union \set{\op \oftype \tyA_{\op} \to \tyB_{\op}}) \casesto {\ctyD}}
	}
\end{mathpar}

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

\begin{mathpar}

	% Match statements
	\inferrule*[]
	{ \judgement{v}{\sumtype{\tyA}{\tyB}} \\
		\judgement[\ctx, x \oftype \tyA]{c_l}{\ctyC} \\
		\judgement[\ctx, x \oftype \tyB]{c_r}{\ctyC} }
	{ \judgement{\match{v} \sumcases{x}{c_l}{x}{c_r} }{\ctyC} }

	\inferrule*[]
	{ \judgement{v}{\producttype{\tyA}{\tyB}} \\
		\judgement[\ctx, x \oftype \tyA, y \oftype \tyB]{c}{\ctyC} }
	{ \judgement{\match{v} \prodcases{x}{y}{c} }{\ctyC} }

	% Function application
	\inferrule*[]
	{ \judgement{v_1}{\tyA \to \ctyC} \\
		\judgement{v_2}{\tyA}	}
	{ \judgement{\apply{v_1}{v_2}}{\ctyC} }

	% Recursive function definition
	% can also be checked
	\inferrule*[]
	{ \judgement[\ctx, f \oftype \tyA \to \ctyC, x \oftype \tyA]{c_1}{\ctyC} \\
	\judgement[\ctx, f \oftype \tyA \to \ctyC]{c_2}{\ctyD}	}
	{ \judgement{\letrec{f}{x}{c_1} c_2}{\ctyD} }

	% Return
	\inferrule*[]
	{ \judgement{v}{\tyA} }
	{ \judgement{\return{v}}{\ctype{\tyA}{\nil}{\nil}} }

	% Operation
	\inferrule*[]
	{ (\op \oftype \tyA_{\op} \to \tyB_{\op}) \in \sig \\
		\judgement{v}{\tyA_{\op}} \\
		\judgement[\ctx, y \oftype \tyB_{\op}]{c}{\ctype{\tyA}{\sig}{\eqE}} }
	{ \judgement{\operation{v}{y.c}}{\ctype{\tyA}{\sig}{\eqE}} }

	% Do-bind
	\inferrule*[]
	{ \judgement{c_1}{\ctype{\tyA}{\sig}{\eqE}} \\
		\judgement[\ctx, x \oftype \tyA]{c_2}{\ctype{\tyB}{\sig}{\eqE}}}
	{ \judgement{\dobind{x}{c_1}{c_2}}{\ctype{\tyB}{\sig}{\eqE}} }

	% Handling
	\inferrule*[]
	{ \judgement{v}{\ctyC \hto \ctyD} \\
		\judgement{c}{\ctyC} }
	{ \judgement{\withhandle{v}{c}}{\ctyD} }

\end{mathpar}
