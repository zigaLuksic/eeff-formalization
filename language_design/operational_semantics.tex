% !TeX root = ./main.tex
% chktex-file 1
% chktex-file 46

%=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
\begin{mathpar}
	
	% MATCH STATEMENTS
	\inferrule*[]	{	}
	{ \match{\pair{v_1}{v_2}} \pair{x}{y} \mapsto c
			\smallstep
		c\subs{x \subswith v_1, y \subswith v_2} } 
	
	\inferrule*[]	{	}
	{ \match{\inleft{v}} \sumcases{x}{c_l}{x}{c_r} 
			\smallstep
		c_l\subs{x \subswith v} }

	\inferrule*[]	{	}
	{ \match{\inright{v}} \sumcases{x}{c_l}{x}{c_r}
			\smallstep
		c_r\subs{x \subswith v} }
	
	% FUNCTION
	\inferrule*[]	{	}
	{ \apply{(\fun{x}{c})}{v} \smallstep c\subs{x \subswith v} }
	
	
	% DO BIND
	\inferrule*[]
	{ c_1 \smallstep c_1' }
	{ \dobind{x}{c_1}{c_2} \smallstep \dobind{x}{c_1'}{c_2} }
	
	\inferrule*[]	{	}
	{ \dobind{x}{\return{v}}{c} \smallstep c\subs{x\subswith v} }
	
	\inferrule*[]	{	}
	{ \dobind{x}{\operation{v}{y.c_1}}{c_2}
			\smallstep
		\operation{v}{y.\dobind{x}{c_1}{c_2}} }
	
	% HANDLE
	
	\inferrule*[]
	{ c \smallstep c'	}
	{ \withhandle{v}{c} \smallstep \withhandle{v}{c'} }
	
	\inferrule*[]	{	}
	{ \withhandle{(\handler h)}{(\return v)} \smallstep c_r\subs{x \subswith v} }
	
	\mprset{flushleft}
	\inferrule*[]
	{	H = (\handler h) \\ (\operation{x}{k} \mapsto c_{\op}) \in h }
	{ \withhandle{H}{(\operation{v}{y.c})}
			\smallstep
		c_{\op}\subs{
			x \subswith v, 
			k \subswith (\fun{y}{\withhandle{H}{c}})} }
	
\end{mathpar}
